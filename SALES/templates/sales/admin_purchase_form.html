{% extends "index.html" %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-7" data-aos="fade-up">
            <div class="premium-card p-4 p-lg-5 border-0 shadow-lg">
                <div class="text-center mb-5">
                    <div class="mb-4 d-inline-flex align-items-center justify-content-center bg-light rounded-circle"
                        style="width: 80px; height: 80px;">
                        <i class="bi bi-receipt-cutoff text-dark fs-1"></i>
                    </div>
                    <h1 class="h4 fw-bold text-dark">
                        {% if purchase %}Editar compra{% else %}Nueva compra{% endif %}
                    </h1>
                    <p class="text-muted small fw-medium">Registra una compra de lotes para un cliente.</p>
                </div>

                <form method="post">
                    {% csrf_token %}
                    <div class="row g-4">
                        <div class="col-12">
                            <label class="form-label small fw-bold text-dark text-uppercase tracking-wider">Cliente</label>
                            <select name="client" required>
                                <option value="">Seleccione un cliente</option>
                                {% for user in clients %}
                                <option value="{{ user.id }}" {% if form.client == user.id %}selected{% endif %}>
                                    {{ user.get_full_name|default:user.email }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-12">
                            <label
                                class="form-label small fw-bold text-dark text-uppercase tracking-wider">Lotes</label>
                            <select name="lots" multiple size="5" required>
                                {% for lot in lots %}
                                <option value="{{ lot.id }}" {% if lot.id in form.lots %}selected{% endif %}>
                                    {{ lot.code }} · {{ lot.stage.name }} · ${{ lot.price }}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text small text-muted mt-1">
                                Mantén presionada la tecla Ctrl (o Cmd) para seleccionar varios lotes.
                            </div>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-dark text-uppercase tracking-wider">Total</label>
                            <input type="number" step="0.01" min="0" name="total_amount" value="{{ form.total_amount }}"
                                required>
                        </div>
                    </div>
                    <div class="d-grid mt-5 gap-3">
                        <button type="submit" class="btn btn-accent py-3 fw-bold">
                            {% if purchase %}Guardar cambios{% else %}Crear compra{% endif %}
                        </button>
                        <a href="{% url 'admin_purchase_list' %}"
                            class="btn btn-link text-muted extra-small mt-1 text-decoration-none fw-bold text-center">
                            <i class="bi bi-arrow-left"></i> Volver al listado de compras
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

