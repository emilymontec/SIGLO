{% extends "index.html" %}

{% block title %}{% if payment %}Editar Pago{% else %}Nuevo Pago{% endif %}{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-10 col-lg-7" data-aos="fade-up">
            <div class="premium-card p-4 p-lg-5 border-0 shadow-lg">
                <div class="text-center mb-5">
                    <div class="mb-4 d-inline-flex align-items-center justify-content-center bg-light rounded-circle"
                        style="width: 80px; height: 80px;">
                        <i class="bi bi-wallet2 text-dark fs-1"></i>
                    </div>
                    <h1 class="h4 fw-bold text-dark">
                        {% if payment %}Editar pago{% else %}Nuevo pago{% endif %}
                    </h1>
                    <p class="text-muted small fw-medium">Registra o ajusta un pago asociado a una compra.</p>
                </div>

                <form method="post">
                    {% csrf_token %}
                    {% if error %}
                    <div class="alert alert-danger" role="alert">{{ error }}</div>
                    {% endif %}
                    <div class="row g-4">
                        <div class="col-12">
                            <label class="form-label small fw-bold text-dark text-uppercase tracking-wider">Compra</label>
                            <select name="purchase" required>
                                <option value="">Seleccione una compra</option>
                                {% for purchase in purchases %}
                                <option value="{{ purchase.id }}" {% if form.purchase == purchase.id %}selected{% endif %}>
                                    #{{ purchase.id }} Â· {{ purchase.client.get_full_name|default:purchase.client.email }}
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label small fw-bold text-dark text-uppercase tracking-wider">Monto</label>
                            <input type="number" step="0.01" min="0.01" name="amount" value="{{ form.amount }}" required>
                            <div class="form-text">El monto no debe exceder el saldo pendiente de la compra seleccionada.</div>
                        </div>
                    </div>
                    <div class="d-grid mt-5 gap-3">
                        <button type="submit" class="btn btn-accent py-3 fw-bold">
                            {% if payment %}Guardar cambios{% else %}Registrar pago{% endif %}
                        </button>
                        <a href="{% url 'admin_payment_list' %}"
                            class="btn btn-link text-muted extra-small mt-1 text-decoration-none fw-bold text-center">
                            <i class="bi bi-arrow-left"></i> Volver al listado de pagos
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
